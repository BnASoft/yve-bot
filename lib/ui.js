!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("./core")):"function"==typeof define&&define.amd?define(["./core"],e):t.YveBot=e(t.YveBot)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};var a=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t};function s(t){return[].slice.call(t)}var r=function(){function t(t){this.options=t,this.chat=this.createChat(),this.typing=this.createTyping(),this.conversation=this.createConversation(),this.textArea=this.createTextarea(),this.inputText=this.createInput(),this.input=this.textArea,this.submit=this.createSubmit(),this.form=this.createForm(),this.conversation.appendChild(this.typing),this.chat.appendChild(this.conversation),this.chat.appendChild(this.form),this.inputValue=""}return t.prototype.createSingleChoiceMessage=function(t,n){var i=this;return t.options.length?(this.disableForm(this.options.inputPlaceholderSingleChoice),this.createBubbleMessage(t,function(t,e){e.remove(),i.enableForm(),n(t.getAttribute("data-label"),t.getAttribute("data-value"))})):document.createElement("div")},t.prototype.createBubbleButton=function(t,e,n){var i=document.createElement("button");i.className="yvebot-message-bubbleBtn",n&&n.className&&i.classList.add(n.className),i.onclick=function(){return e(i)};var o=t.value,a=t.label;return i.setAttribute("data-value",String((void 0===o?a:o)||"")),i.setAttribute("data-label",String((void 0===a?o:a)||"")),i.textContent=i.getAttribute("data-label"),i},t.prototype.disableForm=function(t){this.submit.disabled=!0,this.input.disabled=!0,this.input.placeholder=t,this.inputValue=this.input.value,this.input.value=""},t.prototype.enableForm=function(){this.submit.disabled=!1,this.input.disabled=!1,this.input.placeholder=this.options.inputPlaceholder,this.input.value=this.inputValue,this.inputValue="",this.options.autoFocus&&this.input.focus()},t.prototype.createBubbleMessage=function(r,s){var c=this,t=r.maxOptions,l=void 0===t?0:t,u=this.options.moreOptionsLabel,p=document.createElement("div");p.className="yvebot-message-bubbles yvebot-ruleType-"+r.type;var h=function(o,t){void 0===t&&(t=0);var a=l?t+l-1:o.length;o.slice(t,a).forEach(function(t,e){var n=c.createBubbleButton(t,function(t){s(t,p),"MultipleChoice"!==r.type&&c.scrollDown(0,null,!0)});if(p.appendChild(n),a<o.length&&e===l-2){var i=c.createBubbleButton({label:u},function(){h(o,a),i.remove()},{className:"yvebot-message-bubbleMoreOptions"});p.appendChild(i)}})};return h(r.options),p},t.prototype.createMultipleChoiceMessage=function(t,o){var e=document.createElement("div");if(t.options.length){var a=document.createElement("button");a.textContent=this.options.doneMultipleChoiceLabel,a.className="yvebot-message-bubbleDone",a.style.display="none";var r=this;a.onclick=function(){var t=this.previousElementSibling,e=t.querySelectorAll(".yvebot-message-bubbleBtn.selected"),n=s(e).map(function(t){return t.getAttribute("data-label")}),i=s(e).map(function(t){return t.getAttribute("data-value")});o(n,i),t.remove(),a.remove(),r.enableForm(),r.scrollDown(0,null,!0)};var n=this.createBubbleMessage(t,function(t){t.classList.toggle("selected"),n.querySelectorAll(".yvebot-message-bubbleBtn.selected").length?a.style.display="inline-block":a.style.display="none"});this.disableForm(this.options.inputPlaceholderMultipleChoice),e.appendChild(n),e.appendChild(a)}return e},t.prototype.createChat=function(){var t=document.createElement("div");return t.className="yvebot-chat",t},t.prototype.createConversation=function(){var t=document.createElement("ul");return t.className="yvebot-conversation",t},t.prototype.createTyping=function(){var e=document.createElement("div");return e.className="yvebot-typing",[1,2,3].forEach(function(){var t=document.createElement("span");t.className="yvebot-typing-dot",e.appendChild(t)}),this.createThread("BOT",e,"yvebot-thread-typing")},t.prototype.createForm=function(){var t=document.createElement("form");return t.className="yvebot-form",t.appendChild(this.input),t.appendChild(this.submit),t},t.prototype.createSubmit=function(){var t=document.createElement("button");return t.className="yvebot-form-submit",t.type="submit",t.textContent=this.options.submitLabel,t},t.prototype.createInput=function(){var t=document.createElement("input");return t.className="yvebot-form-input",t.type="text",t.placeholder=this.options.inputPlaceholder,t.autocomplete="off",t},t.prototype.createTextarea=function(){var e=this,t=document.createElement("textarea");return t.className="yvebot-form-input",t.placeholder=this.options.inputPlaceholder,t.rows=1,t.addEventListener("keydown",function(t){13!==(t.keyCode?t.keyCode:t.which)||t.shiftKey||(t.preventDefault(),e.form.dispatchEvent(new Event("submit")))}),t.addEventListener("input",function(t){var e=t.target;e.style.height="auto",e.style.height=e.scrollHeight+"px"}),t},t.prototype.createThread=function(t,e,n){var i=document.createElement("li");return i.className="yvebot-thread yvebot-thread-"+t.toLowerCase(),n&&i.classList.add(n),i.appendChild(e),i},t.prototype.setInputType=function(t){var e={inputText:this.inputText,textarea:this.textArea}[t];this.input!==e&&(this.form.replaceChild(e,this.input),this.input=e),this.options.autoFocus&&this.input.focus()},t.prototype.appendThread=function(t,e,n){var i=this;this.scrollDown(n.offsetHeight,function(){return e.insertBefore(n,i.typing)},"USER"===t)},t.prototype.scrollDown=function(t,e,n){void 0===n&&(n=!1);var i=this.conversation.scrollHeight-this.conversation.scrollTop-this.conversation.offsetHeight-t<=0;e&&e(),(i||n)&&(this.conversation.scrollTop=this.conversation.scrollHeight)},t.prototype.createTextMessage=function(t,e){var n,i,o,a,r,s=this.options,c=s.timestampable,l=s.timestampFormatter;if(t instanceof Array){var u=t.map(String);i=u,o=this.options.andSeparatorText,a=i.slice(0,-1).join(", "),r=i.slice(-1),n=1===i.length?i[0]:a+" "+o+" "+r}else n=String(t);var p=document.createElement("div");if(p.className="yvebot-bubble",e){var h=document.createElement("div");h.className="yvebot-sender",h.innerHTML=e,p.appendChild(h)}var d=document.createElement("div");if(d.className="yvebot-message",d.innerHTML=n,p.appendChild(d),c){var m=document.createElement("div");m.className="yvebot-timestamp",m.innerHTML=l(Date.now()),p.appendChild(m)}return p},t}();return function(o){function t(t,e){var n=this,i=a({},{andSeparatorText:"and",autoFocus:!0,doneMultipleChoiceLabel:"Done",inputPlaceholder:"Type your message",inputPlaceholderMultipleChoice:"Choose the options above",inputPlaceholderSingleChoice:"Choose an option above",moreOptionsLabel:"More options",submitLabel:"Send",target:"body",timestampFormatter:function(t){return new Date(t).toUTCString().slice(-12,-4)},timestampable:!1},e);return(n=o.call(this,t,i.yveBotOptions)||this).UIOptions=i,n.UI=new r(n.UIOptions),n.on("start",function(){document.querySelector(n.UIOptions.target).appendChild(n.UI.chat),n.UIOptions.autoFocus&&n.UI.input.focus()}).on("talk",function(t,e){n.newMessage("BOT",t,e)}).on("typing",function(){return n.typing()}).on("typed",function(){return n.typed()}),n.UI.form.addEventListener("submit",function(t){t.preventDefault();var e=n.UI.input.value.trim();e&&(n.hear(e),n.newMessage("USER",e),n.UI.input.value="",n.UI.input.dispatchEvent(new Event("input"))),n.UIOptions.autoFocus&&n.UI.input.focus()}),n}return function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(t,o),t.prototype.typing=function(){var t=this;return this.UI.scrollDown(this.UI.typing.offsetHeight,function(){return t.UI.typing.classList.add("is-typing")}),this},t.prototype.typed=function(){var t=this;return this.UI.scrollDown(this.UI.typing.offsetHeight,function(){return t.UI.typing.classList.remove("is-typing")}),this},t.prototype.newMessage=function(t,e,n){var i=this,o=this.UI,a="BOT"===t?this.UIOptions.name:null,r=o.createThread(t,o.createTextMessage(e,a));if("BOT"===t)switch(this.UI.setInputType(n.multiline?"textarea":"inputText"),n.type){case"SingleChoice":r.appendChild(o.createSingleChoiceMessage(n,function(t,e){i.hear(e),i.newMessage("USER",t)}));break;case"MultipleChoice":r.appendChild(o.createMultipleChoiceMessage(n,function(t,e){i.hear(e),i.newMessage("USER",t)}))}return o.appendThread(t,this.UI.conversation,r),this},t}(t)});
